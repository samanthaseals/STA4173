---
title: "Dependent Medians: Wilcoxon Signed Rank"
subtitle: "STA4173: Biostatistics"
execute:
  echo: true
format: 
  revealjs:
    theme: uwf
    self-contained: true
    slide-number: false
    footer: "[STA4173 - Biostatistics](https://samanthaseals.github.io/STA4173)"
    width: 1600
    height: 900
    df-print: paged
    html-math-method: katex
editor: source
---

## Introduction

- Last class, we discussed that we turn to nonparametric tests when we do not meet distributional assumptions for *t*-tests.

- If we do not meet the normality assumption for the paired *t*-test,

- Today we will learn the Wilcoxon signed rank, the nonparametric alternative to the dependent *t*-test.

- Like in the dependent *t*-test, we will analyze the *difference* between two values.

- Like in the Wilcoxon rank sum, we will be analyzing ranks.


## Wilcoxon Signed Rank

- Before ranking, we will find the difference between the paired observations and eliminate any 0 differences.

    - Note 1: elimniating 0 differences is the big difference between the other tests! 
    
    - Note 2: because we are eliminating 0 differences, this means that our sample size will update to the number of pairs with a non-0 difference.
    
- When ranking, we the differences are ranked based on the absolute value of the difference.

- We also keep the sign of the difference.

    - We will have positive ranks and negative ranks.

| *X* | *Y* | *D* | \|*D*\| | Rank |
|-----|-----|-----|---------|------|
| 5   | 8   | -3  | 3       | $-$ 1.5 |
| 8   | 5   | 3   | 3       | $+$ 1.5  |
| 4   | 4   | 0   | 0       | ---------   |

## Wilcoxon Signed Rank

**Wilcoxon Signed Rank**

<center><img src="images/L07a.png"></center>

- where

    - $T_+$ is the sum of the positive ranks,
    - $T_-$ is the sum of the negative ranks

## Wilcoxon Signed Rank

-   We will again use the [`wilcox.test()`](https://www.rdocumentation.org/packages/stats/versions/3.6.1/topics/wilcox.test) function to perform the test,

```{r, eval = FALSE}
wilcox.test([variable 1], [variable 2],
       data = [dataset],
       alternative = "[alternative]",
       mu = [hypothesized value],
       paired = TRUE,
       exact = FALSE)
```

## Wilcoxon Signed Rank

- One important variable to consider in trading stock is the daily volume. Volume is measured in number of shares traded in the stock. Stocks with lower volume tend to have more variability in the stock price. 

- A stock analyst believes the median number of shares traded in Walgreens Boots Alliance (WBA) stock is greater than that in McDonald’s (MCD). 

- Because national news can play a role in volume of stock traded, the analyst records the volume (in millions of shares) for each of the two stocks on the same day for 14 randomly selected trading days. Test the analyst’s belief at the $\alpha=0.05$ level of significance.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
```

```{r}
WBA <- c(8.9, 6.3, 6.2, 7.2, 2.8, 3.3, 23.6, 6.0, 15.6, 5.2, 6.3, 10.1, 4.0, 8.4)
MCD <- c(8.5, 7.6, 8.3, 10.4, 2.5, 2.6, 3.5, 4.7, 9.0, 6.0, 5.6, 5.0, 4.4, 5.6)
data <- tibble(WBA, MCD) %>%
  mutate(d = WBA - MCD)
```

## Wilcoxon Signed Rank

- Let's first look at the q-q plot

```{r, echo = FALSE}
data %>% ggplot(aes(sample=d)) +
  stat_qq(size=3) + 
  stat_qq_line() + 
  xlab("Theoretical") +
  ylab("Sample") +
  ggtitle("WBA - MCD")+
  theme_minimal()
```

## Wilcoxon Signed Rank

- Let's also look at summary statistics,

```{r}
data %>% summarize(median(WBA), median(MCD), median(d))
```

- The median for the WBA stock is 6.3 while the median for MCD stock is 5.6.

- The median for the difference between WBA and MCD is 0.55.

## Wilcoxon Signed Rank

- Let's now perform the hypothesis test,

    - From the problem statement: *A stock analyst believes the median number of shares traded in Walgreens Boots Alliance (WBA) stock is greater than that in McDonald’s (MCD).*

```{r, eval = FALSE}
wilcox.test(WBA, MCD,
       data = data,
       alternative = "greater",
       paired = TRUE, 
       exact = FALSE)
```
## Wilcoxon Signed Rank

- **Hypotheses**

    - $H_0: \ M_{\text{WBA}} \le M_{\text{MCD}}$ OR $M_d \le 0$, where $d = \text{WBA} - \text{MCD}$
    - $H_1: \ M_{\text{WBA}} > M_{\text{MCD}}$ OR $M_d > 0$
    
- **Test Statistic and *p*-Value**

    - $T = 69$
    - $p = 0.158$
    
- **Rejection Region**

    - Reject $H_0$ if $p < \alpha$; $\alpha = 0.05$.
    
- **Conclusion/Interpretation**

    - Fail to reject $H_0$.
    
    - There is not sufficient evidence to suggest that the median stock shares traded is greater for WBA than for MCD.
    
## Example

- Recall the insurance data we examined with the paired *t*-test.

    - *Insurance adjusters are concerned about the high estimates they are receiving for auto repairs from garage I compared to garage II.*

```{r}
g1 <- c(17.6, 20.2, 19.5, 11.3, 13.0, 16.3, 15.3, 16.2, 12.2, 14.8, 21.3, 22.1, 16.9, 17.6, 18.4)
g2 <- c(17.3, 19.1, 18.4, 11.5, 12.7, 15.8, 14.9, 15.3, 12.0, 14.2, 21.0, 21.0, 16.1, 16.7, 17.5)
garage <- tibble(g1, g2) %>% mutate(d = g1-g2)
```

- Looking at summaries,

```{r}
garage %>% summarize(median(g1), median(g2), median(d))
```

## Example

```{r, eval = FALSE}
wilcox.test(g1, g2,
       data = garage,
       alternative = "greater",
       paired = TRUE, 
       exact = FALSE)
```

## Example

- **Hypotheses**

    - $H_0: \ M_{\text{I}} \le M_{\text{II}}$ OR $M_d \le 0$, where $d = \text{I} - \text{II}$
    - $H_1: \ M_{\text{I}} > M_{\text{II}}$ OR $M_d > 0$
    
- **Test Statistic and *p*-Value**

    - $T = 118.5$
    - $p < 0.001$
    
- **Rejection Region**

    - Reject $H_0$ if $p < \alpha$; $\alpha = 0.05$.
    
- **Conclusion/Interpretation**

    - Reject $H_0$.
    
    - There is  sufficient evidence to suggest that the median repair estimate from garage I is higher than that of garage II.
