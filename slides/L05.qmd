---
title: "Assessing Assumptions on *t*-Tests"
subtitle: "STA4173: Biostatistics"
execute:
  echo: true
format: 
  revealjs:
    theme: uwf
    self-contained: true
    slide-number: false
    footer: "[STA4173 - Biostatistics](https://samanthaseals.github.io/STA4173)"
    width: 1600
    height: 900
    df-print: paged
    html-math-method: katex
editor: source
---

## Introduction

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
```

- We have now learned one- and two-sample *t*-tests.

- Recall, when we have two samples, they can be independent samples or dependent samples.

    - Independent samples: two-sample *t*-test
    
    - Dependent samples: paired *t*-test (one-sample *t*-test on difference)
    
- Today we will discuss how to assess the assumptions on *t*-tests.

## Normality Assumption: Set Up

- All *t*-tests assume approximate normality of the data.

    - In the case of one-sample *t*-tests, the measure of interest must somewhat follow a normal distribution.

    - In the case of two-sample *t*-tests, the measure of interest *in each group* must somewhat follow a normal distribution.
    
- Note that a paired *t*-test is technically a one-sample *t*-test, so we will examine normality of the difference. 

## Normality Assumption: Set Up

- There are formal tests for normality ([see article here](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3693611/)), however, we will not use them.

    - Tests for normality are not well-endorsed by statisticians.
    
- Instead, we will assess normality using a quantile-quantile (q-q) plot.

    - This is a scatterplot that will form a 45&deg; line if the assumed distribution is correct.
    
    - [Here is more information about q-q plots](https://data.library.virginia.edu/understanding-q-q-plots/).

- We will create q-q plots for:

    - The measurements in the case of the one-sample *t*-test.

    - The measurements from each group in the case of the two-sample *t*-test.
    
    - The difference between the groups in the case of the paired *t*-test.
    
## Normality Assumption: R Syntax

- We can construct q-q plots using `ggplot2` in `tidyverse`.

```{r, eval = FALSE}
dataset %>% # pipe in data
  ggplot(aes(sample = [variable])) + # call ggplot(), specify the variable to be examined
  stat_qq(size=3) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical"
       y = "Sample") # change axis labels
  theme(text = element_text(size=14)) # change font size
```

## Normality Assumption: Exploring Q-Q Plots

- Let's simulate data from a normal distribution and look at a q-q plot.

```{r, eval = FALSE}
outcome <- rnorm(10) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample") + # change axis labels
  theme(text = element_text(size=14)) # change font size
```

## Normality Assumption: Exploring Q-Q Plots

<center>
```{r, echo = FALSE}
outcome <- rnorm(10) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 10") + # change axis labels
  theme(text = element_text(size=14)) # change font size
```
</center>

## Normality Assumption: Exploring Q-Q Plots

```{r, echo = FALSE, message = FALSE, warning = FALSE}
outcome <- rnorm(10) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

a <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 10") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-3.5, 3.5) +
  theme(text = element_text(size=14)) # change font size

outcome <- rnorm(50) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

b <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 50") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-3.5, 3.5) +
  theme(text = element_text(size=14)) # change font size

outcome <- rnorm(100) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

c <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 100") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-3.5, 3.5) +
  theme(text = element_text(size=14)) # change font size

outcome <- rnorm(1000) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

d <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 1000") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-3.5, 3.5) +
  theme(text = element_text(size=14)) # change font size

library(ggpubr)
ggarrange(a, b, c, d, ncol = 2, nrow = 2)
```

## Normality Assumption: Exploring Q-Q Plots

- What about an exponential distribution?

<center>
```{r, echo = FALSE, message = FALSE, warning = FALSE}
outcome <- rexp(10) 
sim_normal <- tibble(outcome)

a <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 10") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-1, 3.5) +
  theme(text = element_text(size=14)) # change font size

outcome <- rexp(50) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

b <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 50") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-1, 3.5) +
  theme(text = element_text(size=14)) # change font size

outcome <- rexp(100) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

c <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 100") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-1, 3.5) +
  theme(text = element_text(size=14)) # change font size

outcome <- rexp(1000) # simulate from N(0, 1)
sim_normal <- tibble(outcome)

d <- sim_normal %>% # pipe in data
  ggplot(aes(sample = outcome)) + # call ggplot(), specify the variable to be examined
  stat_qq(size=1.5) + # request q-q scatterplot
  stat_qq_line() + # request q-q 45* line
  theme_bw() + # change background :)
  labs(x = "Theoretical",
       y = "Sample",
       title = "n = 1000") + # change axis labels
  xlim(-3.5, 3.5) +
  ylim(-1, 3.5) +
  theme(text = element_text(size=14)) # change font size

library(ggpubr)
ggarrange(a, b, c, d, ncol = 2, nrow = 2)
```
</center>

## Normality Assumption: Space Rat Example

- Recall the space/earth rat example for the two-sample *t*-test.

    - We need to make a separate q-q plot for each group.

```{r}
space_rbc <- c(8.59, 6.87, 7.00, 8.64, 7.89, 8.80, 7.43, 9.79, 9.30, 7.21, 6.85, 8.03, 6.39, 7.54)
space <- tibble(space_rbc)

space_qq <- space %>%
  ggplot(aes(sample = space_rbc)) +
  stat_qq(size=1.5) +
  stat_qq_line() +
  labs(x = "Theoretical",
       y = "Sample",
       title = "Space Rats") +
  ylim(5, 11) +
  theme_bw() +
  theme(text = element_text(size=14))
```

## Normality Assumption: Space Rat Example

- Recall the space/earth rat example for the two-sample *t*-test.

    - We need to make a separate q-q plot for each group.

```{r}
earth_rbc <- c(8.65, 7.62, 7.33, 6.99, 7.44, 8.58, 8.40, 8.55, 9.88, 9.66, 8.70, 9.94, 7.14, 9.14)
earth <- tibble(earth_rbc)
  
earth_qq <- earth %>%
  ggplot(aes(sample = earth_rbc)) +
  stat_qq(size=1.5) +
  stat_qq_line() +
  labs(x = "Theoretical",
       y = "Sample",
       title = "Earth Rats") +
  ylim(5, 11) +
  theme_bw() +
  theme(text = element_text(size=14))
```

## Normality Assumption: Space Rat Example

- Putting the graphs together,

<center>
```{r}
library(ggpubr)
ggarrange(space_qq, earth_qq, ncol = 2) # put graphs together
```
</center>

- What do we think? Do we meet the normality assumption?

## Normality Assumption: Repair Estimates

- Recall the repair estimate example for the dependent *t*-test.

```{r, eval = FALSE}
g1 <- c(17.6, 20.2, 19.5, 11.3, 13.0, 16.3, 15.3, 16.2, 12.2, 14.8, 21.3, 22.1, 16.9, 17.6, 18.4)
g2 <- c(17.3, 19.1, 18.4, 11.5, 12.7, 15.8, 14.9, 15.3, 12.0, 14.2, 21.0, 21.0, 16.1, 16.7, 17.5)
garage <- tibble(g1, g2) %>% # create dataset with both garages
  mutate(d = g1-g2) # create variable of differences

garage %>%
  ggplot(aes(sample = d)) +
  stat_qq(size=1.5) +
  stat_qq_line() +
  labs(x = "Theoretical",
       y = "Sample") +
  #ylim(5, 11) +
  theme_bw() +
  theme(text = element_text(size=14))
```
## Normality Assumption: Repair Estimates

- Recall the repair estimate example for the dependent *t*-test.

<center>
```{r, echo = FALSE}
g1 <- c(17.6, 20.2, 19.5, 11.3, 13.0, 16.3, 15.3, 16.2, 12.2, 14.8, 21.3, 22.1, 16.9, 17.6, 18.4)
g2 <- c(17.3, 19.1, 18.4, 11.5, 12.7, 15.8, 14.9, 15.3, 12.0, 14.2, 21.0, 21.0, 16.1, 16.7, 17.5)
garage <- tibble(g1, g2) %>% # create dataset with both garages
  mutate(d = g1-g2) # create variable of differences

garage %>%
  ggplot(aes(sample = d)) +
  stat_qq(size=1.5) +
  stat_qq_line() +
  labs(x = "Theoretical",
       y = "Sample") +
  #ylim(5, 11) +
  theme_bw() +
  theme(text = element_text(size=14))
```
</center>

- What do we think? Do we meet the normality assumption?

## Variance Assumption: Set Up

- When doing the two-sample *t*-test, there is an assumption of equal variance.

- We will formally test using the folded *F* test,

<center><img src="images/L05a.png" width=700></center>

## Variance Assumption: R Syntax

- We will use the [`var.test()` function](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/var.test). 

    - The syntax is very similar to how we called the `t.test()` function.

```{r, eval = FALSE}
var.test([continuous] ~ [grouping], 
         data = [dataset])
```

## Variance Assumption: Space Rat Example

- Let's assess the variance assumption on the space/earth rat example.

```{r}
rbc <- c(8.59, 8.64, 7.43, 7.21, 6.39, 6.87, 7.89,
         9.79, 6.85, 7.54, 7.00, 8.80, 9.30, 8.03,
         8.65, 6.99, 8.40, 9.66, 7.14, 7.62, 7.44,
         8.55, 8.70, 9.14, 7.33, 8.58, 9.88, 9.94) # enter blood cell mass
rat <- c(rep("Space",14), rep("Earth",14)) # enter identifier 
data <- tibble(rat, rbc) # create dataset

var.test(rbc ~ rat, data = data)
```

## Variance Assumption: Space Rat Example

- **Hypotheses**

    -   $H_0: \ \sigma^2_{\text{E}} = \sigma^2_{\text{S}}$
    -   $H_1: \ \sigma^2_{\text{E}} \ne \sigma^2_{\text{S}}$

-   **Test Statistic and *p*-Value**

    -   $F_0 = 0.977$
    -   $p = 0.967$

- **Conclusion/Interpretation**

    -   Fail to reject $H_0$. 
    
    - There is not sufficient evidence to suggest that the variances are different between earth and space rats.

## What Next?

- What happens if we break an assumption?

- If we break the normality assumption $\to$ use a nonparametric method.

    - We will cover nonparametric versions of *t*-tests next week :)
    
- If we break the variance assumption of the two-sample *t*-test $\to$ use Satterthwaite's approximation.

    - This estimates the df of the *t* distribution. $$\text{df}=\frac{ \left( \frac{s^2_1}{n_1} + \frac{s_2^2}{n_2} \right)^2 }{ \frac{(s_1^2/n_1)^2}{n_1-1} + \frac{(s_2^2/n_2)^2}{n_2-1}}$$
    
    - The good news: R assumes unequal variances in `t.test()` :) 
    
- **Important note!!** 

    - *I do not expect you to agree with my assessment of q-q plots!* 
    - What I do expect is that you know what to do after making your assessment.


